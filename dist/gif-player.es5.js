!function(){"use strict";function e(e){var n=0;if(71!==e[n++]||73!==e[n++]||70!==e[n++]||56!==e[n++]||56!=(e[n++]+1&253)||97!==e[n++])throw"Invalid GIF 87a/89a header.";var i=e[n++]|e[n++]<<8,s=e[n++]|e[n++]<<8,a=e[n++],r=a>>7,o=1<<(7&a)+1;e[n++];e[n++];var h=null;r&&(h=n,n+=3*o);var l=!0,c=[],u=0,d=null,f=0,p=null;for(this.width=i,this.height=s;l&&n<e.length;)switch(e[n++]){case 33:switch(e[n++]){case 255:if(11!==e[n]||78==e[n+1]&&69==e[n+2]&&84==e[n+3]&&83==e[n+4]&&67==e[n+5]&&65==e[n+6]&&80==e[n+7]&&69==e[n+8]&&50==e[n+9]&&46==e[n+10]&&48==e[n+11]&&3==e[n+12]&&1==e[n+13]&&0==e[n+16])n+=14,p=e[n++]|e[n++]<<8,n++;else for(n+=12;;){if(0===(C=e[n++]))break;n+=C}break;case 249:if(4!==e[n++]||0!==e[n+4])throw"Invalid graphics extension block.";var m=e[n++];u=e[n++]|e[n++]<<8,d=e[n++],0==(1&m)&&(d=null),f=m>>2&7,n++;break;case 254:for(;;){if(0===(C=e[n++]))break;n+=C}break;default:throw"Unknown graphic control label: 0x"+e[n-1].toString(16)}break;case 44:var _=e[n++]|e[n++]<<8,v=e[n++]|e[n++]<<8,y=e[n++]|e[n++]<<8,g=e[n++]|e[n++]<<8,b=e[n++],k=b>>6&1,w=1<<(7&b)+1,x=h,B=!1;if(b>>7){B=!0;x=n,n+=3*w}var E=n;for(n++;;){var C=e[n++];if(0===C)break;n+=C}c.push({x:_,y:v,width:y,height:g,has_local_palette:B,palette_offset:x,data_offset:E,data_length:n-E,transparent_index:d,interlaced:!!k,delay:u,disposal:f});break;case 59:l=!1;break;default:throw"Unknown gif block: 0x"+e[n-1].toString(16)}this.numFrames=function(){return c.length},this.loopCount=function(){return p},this.frameInfo=function(e){if(e<0||e>=c.length)throw"Frame index out of range.";return c[e]},this.decodeAndBlitFrameRGBA=function(n,s){var a=this.frameInfo(n),r=a.width*a.height,o=new Uint8Array(r);t(e,a.data_offset,o,r);var h=a.palette_offset,l=a.transparent_index;null===l&&(l=256);var c=a.width,u=i-c,d=c,f=4*(a.y*i+a.x),p=4*((a.y+a.height)*i+a.x),m=f,_=4*u;!0===a.interlaced&&(_+=4*i*7);for(var v=8,y=0,g=o.length;y<g;++y){var b=o[y];if(0===d&&(d=c,(m+=_)>=p&&(_=4*u+4*i*(v-1),m=f+(c+u)*(v<<1),v>>=1)),b===l)m+=4;else{var k=e[h+3*b],w=e[h+3*b+1],x=e[h+3*b+2];s[m++]=k,s[m++]=w,s[m++]=x,s[m++]=255}--d}}}function t(e,t,n,i){for(var s=e[t++],a=1<<s,r=a+1,o=r+1,h=s+1,l=(1<<h)-1,c=0,u=0,d=0,f=e[t++],p=new Int32Array(4096),m=null;;){for(;c<16&&0!==f;)u|=e[t++]<<c,c+=8,1===f?f=e[t++]:--f;if(c<h)break;var _=u&l;if(u>>=h,c-=h,_!==a){if(_===r)break;for(var v=_<o?_:m,y=0,g=v;g>a;)g=p[g]>>8,++y;var b=g;if(d+y+(v!==_?1:0)>i)return void console.log("Warning, gif stream longer than expected.");n[d++]=b;var k=d+=y;for(v!==_&&(n[d++]=b),g=v;y--;)g=p[g],n[--k]=255&g,g>>=8;null!==m&&o<4096&&(p[o++]=m<<8|b,o>=l+1&&h<12&&(++h,l=l<<1|1)),m=_}else o=r+1,l=(1<<(h=s+1))-1,m=null}return d!==i&&console.log("Warning, gif stream shorter than expected."),n}var n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},r=function(){var t=document.createElement("template");t.innerHTML="\n<style>\n  canvas {\n    position: absolute;\n  }\n\n  @keyframes spinner {\n    to {transform: rotate(360deg);}\n  }\n\n  .spinner:before {\n    content: '';\n    box-sizing: border-box;\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 20px;\n    height: 20px;\n    margin-top: -10px;\n    margin-left: -10px;\n    border-radius: 50%;\n    border-top: 2px solid #999;\n    border-right: 2px solid transparent;\n    animation: spinner .6s linear infinite;\n  }\n</style>\n<canvas></canvas>\n<div class=\"spinner\"></spinner>\n";var r=function(r){function o(){n(this,o);var e=a(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));e._speed=.5,e._size="auto",e._swipe=!0,e._repeat=!0,e._bounce=!1,e._prerender=!1,e._direction=1,e._reset(),e.pausePlaybackBound=e.pausePlayback.bind(e),e.moveBound=e.move.bind(e),e.resumePlaybackBound=e.resumePlayback.bind(e),e.prerenderFramesBound=e.prerenderFrames.bind(e),e.playLoopBound=e.playLoop.bind(e);var i=e.attachShadow({mode:"open"});return i.appendChild(document.importNode(t.content,!0)),e._spinner=i.querySelector(".spinner"),e._canvas=i.querySelector("canvas"),e._ctx=e._canvas.getContext("2d"),e}return s(o,r),i(o,null,[{key:"observedAttributes",get:function(){return["src","frame","size","speed","play","swipe","repeat","bounce","direction"]}}]),i(o,[{key:"connectedCallback",value:function(){this.style.display="inline-block",this.style.position="relative",this.style.overflow="hidden",this.style.cursor="col-resize",this.addEventListener("touchstart",this.pausePlaybackBound,!1),this.addEventListener("touchmove",this.moveBound,!1),this.addEventListener("touchend",this.resumePlaybackBound,!1),this.addEventListener("mouseenter",this.pausePlaybackBound,!1),this.addEventListener("mousemove",this.moveBound,!1),this.addEventListener("mouseleave",this.resumePlaybackBound,!1)}},{key:"disconnectedCallback",value:function(){this.removeEventListener("touchstart",this.pausePlaybackBound,!1),this.removeEventListener("touchmove",this.moveBound,!1),this.removeEventListener("touchend",this.resumePlaybackBound,!1),this.removeEventListener("mouseenter",this.pausePlaybackBound,!1),this.removeEventListener("mousemove",this.moveBound,!1),this.removeEventListener("mouseleave",this.resumePlaybackBound,!1)}},{key:"attributeChangedCallback",value:function(e,t,n){t!==n&&(this[e]=n)}},{key:"_reset",value:function(){this._frames=[],this._delays=[],this._frame=0,this._decoded=-1,this._rendered=-1}},{key:"_handleBoolean",value:function(e,t){this["_"+e]=t=null!==t&&void 0!==t,t?this.setAttribute(e,""):this.removeAttribute(e)}},{key:"move",value:function(e){e.preventDefault();var t;t=e.targetTouches?e.targetTouches[0].clientX:e.clientX;var n=this.getBoundingClientRect(),i=(t-n.left)/n.width;this.frame=Math.round((this._frames.length-1)*i)}},{key:"load",value:function(t){var n=this;this._reset(),this.dispatchEvent(new CustomEvent("gif-loading",{bubbles:!0,composed:!0,detail:t})),this._spinner.style.display="block";var i={method:"GET",mode:"cors",cache:"default"};fetch(t,i).then(function(e){return e.arrayBuffer()}).then(function(e){return new Uint8Array(e)}).then(function(t){return new e(t)}).then(function(e){return n.process(e)}).then(function(){return n._spinner.style.display="none"})}},{key:"process",value:function(e){this._gif=e,this._canvas.width=e.width,this._canvas.height=e.height;var t=e.width/e.height,n=this.clientWidth/this.clientHeight;switch(this._canvas.style.top=0,this._canvas.style.left=0,this._size){case"auto":this.style.width=e.width+"px",this.style.height=e.height+"px";break;case"cover":t>n?(i=this.clientHeight*t,s=this.clientHeight,this._canvas.style.top=0,this._canvas.style.left=-(i-this.clientWidth)/2+"px"):(i=this.clientWidth,s=this.clientWidth/t,this._canvas.style.top=-(s-this.clientHeight)/2+"px",this._canvas.style.left=0),this._canvas.style.width=i+"px",this._canvas.style.height=s+"px";break;case"contain":var i,s;t>n?(i=this.clientWidth,s=this.clientWidth/t,this._canvas.style.top=(this.clientHeight-s)/2+"px",this._canvas.style.left=0):(i=this.clientHeight*t,s=this.clientHeight,this._canvas.style.top=0,this._canvas.style.left=(this.clientWidth-i)/2+"px"),this._canvas.style.width=i+"px",this._canvas.style.height=s+"px";break;case"stretch":this._canvas.style.width="100%",this._canvas.style.height="100%"}var a=e.numFrames();this._decoded=-1,this._delays=new Array(a),this._frames=new Array(a),this._frame<0&&(this._frame=this._frames.length+this._frame);var r=new CustomEvent("gif-loaded",{bubbles:!0,composed:!0,detail:e});this.dispatchEvent(r),this._onload&&this._onload(r),this._play?this.start():this.displayFrame(this._frames,this._frame),this._prerender&&requestIdleCallback(this.prerenderFramesBound)}},{key:"start",value:function(){this.playing=!0,this.playAnimation(this._frames,this._frame)}},{key:"stop",value:function(){this.playing=!1}},{key:"pausePlayback",value:function(e){this.paused=!0}},{key:"resumePlayback",value:function(e){this.paused=!1,this.playing&&this.playAnimation(this._frames,this._frame)}},{key:"playLoop",value:function(e){this.rafHandle=requestAnimationFrame(this.playLoopBound),this._rendered!=this._frame&&this._frames[this._frame]&&(this._rendered=this._frame,this._ctx.putImageData(this._frames[this._frame],0,0))}},{key:"playAnimation",value:function(e,t){var n=this;0!==e.length&&(this.renderFrame(t),setTimeout(function(){if(!n.paused){var e=n.frame+n._direction;e<0?n._bounce?(n._direction=1,e=1):e=n._frames.length-1:e>=n._frames.length&&(n._bounce?(n._direction=-1,e=n._frames.length-2):e=0),n.frame=e,n.playAnimation(n._frames,n._frame)}},this._delays[t]*(1/this._speed)))}},{key:"next",value:function(){++this.frame>=this._frames.length&&(this.frame=0),this.render(this.frame)}},{key:"displayFrame",value:function(e,t){var n=this;0!==e.length&&(t>=e.length&&(t=e.length-1),t<0&&(t+=e.length),this.renderFrame(t),this._rendered!=t&&requestAnimationFrame(function(){n._ctx.putImageData(n._frames[t],0,0),n._rendered=t,n.dispatchEvent(new CustomEvent("gif-frame",{bubbles:!0,composed:!0,detail:t}))}))}},{key:"renderFrame",value:function(e){for(;this._decoded<e;){var t=this._decoded+1,n=this._gif.frameInfo(t),i=this._ctx.createImageData(this._gif.width,this._gif.height);t>0&&n.disposal<2&&i.data.set(new Uint8ClampedArray(this._frames[t-1].data)),this._gif.decodeAndBlitFrameRGBA(t,i.data),this._frames[t]=i,this._delays[t]=10*n.delay,this._decoded=t}}},{key:"prerenderFrames",value:function(e){for(;e.timeRemaining()>0&&this._decoded<this._frames.length-1;)this.renderFrame(this._decoded+1);this._decoded<this._frames.length-1&&requestIdleCallback(this.prerenderBound)}},{key:"src",get:function(){return this._src},set:function(e){this._src=e,this.load(e)}},{key:"frame",get:function(){return this._frame},set:function(e){this._frame=parseInt(e),this.displayFrame(this._frames,this._frame)}},{key:"size",get:function(){return this._size},set:function(e){this._size=e}},{key:"speed",get:function(){return this._speed},set:function(e){this._speed=parseFloat(e)}},{key:"swipe",get:function(){return this._swipe},set:function(e){this._swipe=e}},{key:"play",get:function(){return this._play},set:function(e){this._handleBoolean("play",e)}},{key:"repeat",get:function(){return this._repeat},set:function(e){this._repeat=parseFloat(e)}},{key:"bounce",get:function(){return this._bounce},set:function(e){this._handleBoolean("bounce",e)}},{key:"direction",get:function(){return this._direction},set:function(e){this._direction=parseInt(e)}},{key:"prerender",get:function(){return this._prerender},set:function(e){this._prerender=e}},{key:"onload",get:function(){return this._onload},set:function(e){this._onload=e}}]),o}(HTMLElement);window.customElements.define("gif-player",r)};window.requestIdleCallback=window.requestIdleCallback||function(e){var t=Date.now();return setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})},1)},window.cancelIdleCallback=window.cancelIdleCallback||function(e){clearTimeout(e)},window.WebComponents&&window.WebComponents.ready?r():window.addEventListener("WebComponentsReady",r)}();
//# sourceMappingURL=gif-player.es5.js.map
